---
title: db.history
description: ダウンロード履歴/アップロード履歴のデータベース保存に用いるマッパーモデルを提供する。
---

## DownloadHistory
当システムの動的なサービス設定情報のデータベース保存に用いるマッパーモデル定義。  
SQLAlchemy ORM を用いてデータベースの `download_history` テーブルとマッピングされる。  
テーブル定義書 [download_history テーブル](../../03.db/02.history.md#download_history-テーブル) を参照。

#### シグネチャ
```python[history.py]
class DownloadHistory(db.Model):
```

#### 依存するライブラリ
- **SQLAlchemy**： ORM として使用。

#### 継承元
`SQLAlchemy.Model`

#### クラス属性

| 名前                          | 型       | 説明                                 |
| ----------------------------- | -------- | ------------------------------------ |
| &#95;&#95;tablename&#95;&#95; | str      | テーブル名。`download_history`       |
| id                            | UUID7    | ダウンロード履歴のID                 |
| timestamp                     | datetime | ダウンロード日時                     |
| file_id                       | UUID7    | ダウンロードファイルのID             |
| operator                      | str      | ダウンロード実行者                   |
| public                        | bool     | 履歴の公開設定                       |
| parent_id                     | UUID7    | 再ダウンロード時の初回ダウンロードID |

#### マッピング

| カラム名  | データ型                           | 主キー | NULL 許容 | デフォルト値 |
| --------- | ---------------------------------- | ------ | --------- | ------------ |
| id        | sqlalchemy.UUID                    | Yes    |           |              |
| timestamp | sqlalchemy.DateTime(timezone=True) |        |           | 協定世界時   |
| file_id   | sqlalchemy.UUID                    |        |           |              |
| operator  | sqlalchemy.String(50)              |        |           |              |
| public    | sqlalchemy.Boolean                 |        |           | True         |
| parent_id | sqlalchemy.UUID                    |        | Yes       |              |

#### 備考
(なし)

## UploadHistory
当システムの動的なサービス設定情報のデータベース保存に用いるマッパーモデル定義。  
SQLAlchemy ORM を用いてデータベースの `upload_history` テーブルとマッピングされる。  
テーブル定義書 [upload_history テーブル](../../03.db/02.history.md#upload_history-テーブル) を参照。

#### シグネチャ
```python[history.py]
class UploadHistory(db.Model):
```

#### 依存するライブラリ
- **SQLAlchemy**： ORM として使用。

#### 継承元
`SQLAlchemy.Model`

#### クラス属性

| 名前                          | 型       | 説明                         |
| ----------------------------- | -------- | ---------------------------- |
| &#95;&#95;tablename&#95;&#95; | str      | テーブル名。`upload_history` |
| id                            | UUID7    | アップロード履歴のID         |
| timestamp                     | datetime | アップロード開始日時         |
| end_timestamp                 | datetime | アップロード終了日時         |
| file_id                       | UUID7    | アップロードファイルのID     |
| operator                      | str      | アップロード実行者           |
| public                        | bool     | 履歴の公開設定               |
| status                        | Status   | アップロード状況             |
| results                       | dict     | アップロード結果             |

#### マッピング

| カラム名      | データ型                           | 主キー | NULL 許容 | デフォルト値 |
| ------------- | ---------------------------------- | ------ | --------- | ------------ |
| id            | sqlalchemy.UUID                    | Yes    |           |              |
| timestamp     | sqlalchemy.DateTime(timezone=True) |        |           | 協定世界時   |
| end_timestamp | sqlalchemy.DateTime(timezone=True) |        | Yes       |              |
| file_id       | sqlalchemy.UUID                    |        |           |              |
| operator      | sqlalchemy.String(50)              |        |           |              |
| public        | sqlalchemy.Boolean                 |        |           | True         |
| status        | sqlalchemy.String(1)               |        |           |              |
| results       | sqlalchemy.ext.mutable.MutableDict |        | Yes       |              |

#### 備考
- `status`カラムの型Statusはtyping.Literal\["S", "P", "F"\]でありそれぞれ(S: Success, P: In Progress, F: Failed)を意味する。
- `results`カラムは PostgreSQL で JSONB 型を使用する。

## Files
当システムの動的なサービス設定情報のデータベース保存に用いるマッパーモデル定義。  
SQLAlchemy ORM を用いてデータベースの `files` テーブルとマッピングされる。  
テーブル定義書 [files テーブル](../../03.db/02.history.md#files-テーブル) を参照。

#### シグネチャ
```python[history.py]
class Files(db.Model):
```

#### 依存するライブラリ
- **SQLAlchemy**： ORM として使用。

#### 継承元
`SQLAlchemy.Model`

#### クラス属性

| 名前                          | 型    | 説明                         |
| ----------------------------- | ----- | ---------------------------- |
| &#95;&#95;tablename&#95;&#95; | str   | テーブル名。`files`          |
| id                            | UUID7 | ファイルID                   |
| file_path                     | str   | ファイルパス                 |
| location                      | str   | ファイルの保存場所           |
| file_content                  | dict  | ファイル内のユーザー等の情報 |

#### マッピング

| カラム名     | データ型                           | 主キー | NULL 許容 | デフォルト値 |
| ------------ | ---------------------------------- | ------ | --------- | ------------ |
| id           | sqlalchemy.UUID                    | Yes    |           |              |
| file_path    | sqlalchemy.String(1024)            |        |           |              |
| location     | sqlalchemy.String(1024)            |        |           |              |
| file_content | sqlalchemy.ext.mutable.MutableDict |        |           |              |

#### 備考
`file_content`カラムは PostgreSQL で JSONB 型を使用する。
