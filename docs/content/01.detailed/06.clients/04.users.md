---
title: clients.users
description: mAP Core API V2 の User Resource API を操作するクライアント機能を提供する。
---

## get_by_id
ユーザー ID に基づいて mAP Core API からユーザー情報を取得する機能を提供する。

#### 対応エンドポイント
**GET** /api/v2/Users/{id}

#### シグネチャ
```python[users.py]
def get_by_id(
    user_id: str, /, include: set[str] | None = None, exclude: set[str] | None = None,
    *, access_token: str, client_secret: str,
) -> MapUser | MapError:
```

#### 依存するライブラリ
- **requests**： HTTP リクエストの送信に使用。
- **pydantic**： レスポンスのバリデーションおよびデシリアライズに使用。

#### 引数

| 名前          | 型                 | 説明                                                      |
| ------------- | ------------------ | --------------------------------------------------------- |
| user_id       | str                | ユーザーID                                                |
| include       | set\[str\] \| None | 取得するフィールドのセット。None の場合はすべて取得       |
| exclude       | set\[str\] \| None | 除外するフィールドのセット。None の場合は除外しない       |
| access_token  | str                | （キーワード引数） mAP Core APIのアクセストークン         |
| client_secret | str                | （キーワード引数） mAP Core APIのクライアントシークレット |

#### 戻り値

| 型                                                  | 説明                                           |
| --------------------------------------------------- | ---------------------------------------------- |
| [MapUser](../03.entities/03.map_user.md#mapuser)    | 取得されたユーザー情報                         |
| [MapError](../03.entities/04.map_error.md#maperror) | ユーザー情報が取得されなかった場合のエラー情報 |

#### エラー

| 型                            | 説明                                 |
| ----------------------------- | ------------------------------------ |
| requests.exceptions.HTTPError | 401 以上の HTTP エラーが発生した場合 |

#### 処理内容
1. [`utils:get_time_stamp`](./05.utils.md#get_time_stamp) を呼び出し、タイムスタンプを取得する。
2. タイムスタンプ及び、引数 `access_token`、`client_secret` をもとに
   [`utils:compute_signature`](./05.utils.md#compute_signature) を呼び出し、署名を生成する。
3. 引数 `include` および `exclude` をもとに、取得するフィールドのパラメータを作成する。
   - `include` が None でない場合、カンマ区切りの文字列に結合する。
   - `exclude` が None でない場合、カンマ区切りの文字列に結合とする。
   - フィールド名は camelCase に変換して使用する。
4. mAP Core API に対してリクエストを送信する。
   - エンドポイント [`MAP_USERS_ENDPOINT`](../02.foundation/03.const.md#map_users_endpoint) に対して、GET リクエストを送信する。
   - パスパラメータとして末尾に `/{user_id}` を付与する。
   - クエリパラメータとして以下を付与する。
      | 名前               | 値                                                    |
      | ------------------ | ----------------------------------------------------- |
      | time_stamp         | タイムスタンプ                                        |
      | signature          | 署名                                                  |
      | attributes         | （存在する場合）引数 `include` で指定されたフィールド |
      | excludedAttributes | （存在する場合）引数 `exclude` で指定されたフィールド |
   - リクエストヘッダーに以下を付与する。
      | 名前          | 値                                                        |
      | ------------- | --------------------------------------------------------- |
      | Content-Type  | `application/json`（ **requests** により自動設定される）  |
      | Authorization | アクセストークン。 `"Bearer <access_token>"` の形式で付与 |
   - サーバー設定値に従い、タイムアウト値を設定する。
5. レスポンスを解析し、HTTPステータスコードに応じた処理を行う。
   - ステータスコードが 200 の場合、レスポンスボディを
     [`MapUser`](../03.entities/03.map_user.md#mapuser) のインスタンスにデシリアライズする。
   - ステータスコードが 400 の場合、レスポンスボディを
     [`MapError`](../03.entities/04.map_error.md#maperror) のインスタンスにデシリアライズする。
   - ステータスコードが401以上の場合、`requests.Response.raise_for_status` を呼び出し 例外 `requests.exceptions.HTTPError` を送出する。
6. デシリアライズされたユーザー情報、あるいはエラー情報を戻り値として返す。


## get_by_eppn
EPPN に基づいて mAP Core API からユーザー情報を取得する機能を提供する。

#### 対応エンドポイント
**GET** /api/v2/Existeppn/{eppn}

#### シグネチャ
```python[users.py]
def get_by_eppn(
    eppn: str, /, include: set[str] | None = None, exclude: set[str] | None = None,
    *, access_token: str, client_secret: str
) -> MapUser | MapError:
```

#### 依存するライブラリ
- **requests**： HTTP リクエストの送信に使用。
- **pydantic**： レスポンスのバリデーションおよびデシリアライズに使用。

#### 引数

| 名前          | 型                 | 説明                                                      |
| ------------- | ------------------ | --------------------------------------------------------- |
| eppn          | str                | ユーザーの EPPN                                           |
| include       | set\[str\] \| None | 取得するフィールドのセット。None の場合はすべて取得       |
| exclude       | set\[str\] \| None | 除外するフィールドのセット。None の場合は除外しない       |
| access_token  | str                | （キーワード引数） mAP Core APIのアクセストークン         |
| client_secret | str                | （キーワード引数） mAP Core APIのクライアントシークレット |

#### 戻り値

| 型                                                  | 説明                                           |
| --------------------------------------------------- | ---------------------------------------------- |
| [MapUser](../03.entities/03.map_user.md#mapuser)    | 取得されたユーザー情報                         |
| [MapError](../03.entities/04.map_error.md#maperror) | ユーザー情報が取得されなかった場合のエラー情報 |


#### エラー

| 型                            | 説明                                 |
| ----------------------------- | ------------------------------------ |
| requests.exceptions.HTTPError | 401 以上の HTTP エラーが発生した場合 |

#### 処理内容
1. [`utils:get_time_stamp`](./05.utils.md#get_time_stamp) を呼び出し、タイムスタンプを取得する。
2. タイムスタンプ及び、引数 `access_token`、`client_secret` をもとに
   [`utils:compute_signature`](./05.utils.md#compute_signature) を呼び出し、署名を生成する。
3. 引数 `include` および `exclude` をもとに、取得するフィールドのパラメータを作成する。
   - `include` が None でない場合、カンマ区切りの文字列に結合する。
   - `exclude` が None でない場合、カンマ区切りの文字列に結合とする。
   - フィールド名は camelCase に変換して使用する。
4. mAP Core API に対してリクエストを送信する。
   - エンドポイント [`MAP_EXIST_EPPN_ENDPOINT`](../02.foundation/03.const.md#map_exist_eppn_endpoint) に対して、GET リクエストを送信する。
   - パスパラメータとして末尾に `/{eppn}` を付与する。
   - クエリパラメータとして以下を付与する。
      | 名前               | 値                                                    |
      | ------------------ | ----------------------------------------------------- |
      | time_stamp         | タイムスタンプ                                        |
      | signature          | 署名                                                  |
      | attributes         | （存在する場合）引数 `include` で指定されたフィールド |
      | excludedAttributes | （存在する場合）引数 `exclude` で指定されたフィールド |
   - リクエストヘッダーに以下を付与する。
      | 名前          | 値                                                        |
      | ------------- | --------------------------------------------------------- |
      | Content-Type  | `application/json`（ **requests** により自動設定される）  |
      | Authorization | アクセストークン。 `"Bearer <access_token>"` の形式で付与 |
   - サーバー設定値に従い、タイムアウト値を設定する。
5. レスポンスを解析し、HTTPステータスコードに応じた処理を行う。
   - ステータスコードが 200 の場合、レスポンスボディを
     [`MapUser`](../03.entities/03.map_user.md#mapuser) のインスタンスにデシリアライズする。
   - ステータスコードが 400 の場合、レスポンスボディを
     [`MapError`](../03.entities/04.map_error.md#maperror) のインスタンスにデシリアライズする。
   - ステータスコードが401以上の場合、`requests.Response.raise_for_status` を呼び出し 例外 `requests.exceptions.HTTPError` を送出する。
6. デシリアライズされたユーザー情報、あるいはエラー情報を戻り値として返す。


## post
mAP Core API に対してユーザー情報を登録する機能を提供する。

#### 対応エンドポイント
**POST** /api/v2/Users

#### シグネチャ
```python[users.py]
def post(
    user: MapUser, /, include: set[str] | None = None, exclude: set[str] | None = None,
    *, access_token: str, client_secret: str
) -> MapUser | MapError:
```

#### 依存するライブラリ
- **requests**： HTTP リクエストの送信に使用。
- **pydantic**： リクエストおよびレスポンスのバリデーションおよびシリアライズ・デシリアライズに使用。

#### 引数
| 名前          | 型                 | 説明                                                        |
| ------------- | ------------------ | ----------------------------------------------------------- |
| user          | MapUser            | 登録するユーザー情報                                        |
| include       | set\[str\] \| None | 登録するフィールドのセット。None の場合はすべて登録         |
| exclude       | set\[str\] \| None | 登録から除外するフィールドのセット。None の場合は除外しない |
| access_token  | str                | （キーワード引数） mAP Core APIのアクセストークン           |
| client_secret | str                | （キーワード引数） mAP Core APIのクライアントシークレット   |

#### 戻り値
| 型                                                  | 説明                                         |
| --------------------------------------------------- | -------------------------------------------- |
| [MapUser](../03.entities/03.map_user.md#mapuser)    | 登録されたユーザー情報                       |
| [MapError](../03.entities/04.map_error.md#maperror) | ユーザー情報の登録に失敗した場合のエラー情報 |

#### エラー
| 型                            | 説明                                 |
| ----------------------------- | ------------------------------------ |
| requests.exceptions.HTTPError | 401 以上の HTTP エラーが発生した場合 |

#### 処理内容
1. [`utils:get_time_stamp`](./05.utils.md#get_time_stamp) を呼び出し、タイムスタンプを取得する。
2. タイムスタンプ及び、引数 `access_token`、`client_secret` をもとに
   [`utils:compute_signature`](./05.utils.md#compute_signature) を呼び出し、署名を生成する。
3. 引数 `include` および `exclude` をもとに、取得するフィールドのパラメータを作成する。
   - `include` が None でない場合、カンマ区切りの文字列に結合する。
   - `exclude` が None でない場合、カンマ区切りの文字列に結合とする。
   - フィールド名は camelCase に変換して使用する。
4. mAP Core API に対してリクエストを送信する。
   - エンドポイント [`MAP_USERS_ENDPOINT`](../02.foundation/03.const.md#map_users_endpoint) に対して、POST リクエストを送信する。
   - クエリパラメータとして以下を付与する。
      | 名前               | 値                                                    |
      | ------------------ | ----------------------------------------------------- |
      | attributes         | （存在する場合）引数 `include` で指定されたフィールド |
      | excludedAttributes | （存在する場合）引数 `exclude` で指定されたフィールド |
    - リクエストヘッダーに以下を付与する。
      | 名前          | 値                                                        |
      | ------------- | --------------------------------------------------------- |
      | Content-Type  | `application/json`（ **requests** により自動設定される）  |
      | Authorization | アクセストークン。 `"Bearer <access_token>"` の形式で付与 |
   - リクエストボディに、引数 `user` をシリアライズし、以下のフィールドを追加した JSON を設定する。
      | 名前                               | 値                   |
      | ---------------------------------- | -------------------- |
      | request                            | 認証情報オブジェクト |
      | &nbsp;&nbsp;&nbsp;&nbsp;time_stamp | タイムスタンプ       |
      | &nbsp;&nbsp;&nbsp;&nbsp;signature  | 署名                 |
   - サーバー設定値に従い、タイムアウト値を設定する。
5. レスポンスを解析し、HTTPステータスコードに応じた処理を行う。
   - ステータスコードが 201 の場合、レスポンスボディを
     [`MapUser`](../03.entities/03.map_user.md#mapuser) のインスタンスにデシリアライズする。
   - ステータスコードが 400 の場合、レスポンスボディを
     [`MapError`](../03.entities/04.map_error.md#maperror) のインスタンスにデシリアライズする。
   - ステータスコードが401以上の場合、`requests.Response.raise_for_status` を呼び出し 例外 `requests.exceptions.HTTPError` を送出する。
6. デシリアライズされたユーザー情報、あるいはエラー情報を戻り値として返す。


## ~~put_by_id~~
ユーザー ID に基づいて mAP Core API 上のユーザー情報を更新する機能を提供する。（実装未定）

#### 対応エンドポイント
**PUT** /api/v2/Users/{id}

#### シグネチャ
```python[users.py]
def put_by_id(
    user: MapUser, /, include: set[str] | None = None, exclude: set[str] | None = None,
    *, access_token: str, client_secret: str
) -> MapUser | MapError:
```

#### 依存するライブラリ
- **requests**： HTTP リクエストの送信に使用。
- **pydantic**： リクエストおよびレスポンスのバリデーションおよびシリアライズ・デシリアライズに使用。

#### 引数
| 名前          | 型                 | 説明                                                        |
| ------------- | ------------------ | ----------------------------------------------------------- |
| user          | MapUser            | 更新するユーザー情報                                        |
| include       | set\[str\] \| None | 更新するフィールドのセット。None の場合はすべて更新         |
| exclude       | set\[str\] \| None | 更新から除外するフィールドのセット。None の場合は除外しない |
| access_token  | str                | （キーワード引数） mAP Core APIのアクセストークン           |
| client_secret | str                | （キーワード引数） mAP Core APIのクライアントシークレット   |

#### 戻り値
| 型                                                  | 説明                                         |
| --------------------------------------------------- | -------------------------------------------- |
| [MapUser](../03.entities/03.map_user.md#mapuser)    | 更新されたユーザー情報                       |
| [MapError](../03.entities/04.map_error.md#maperror) | ユーザー情報の更新に失敗した場合のエラー情報 |

#### エラー
| 型                            | 説明                                 |
| ----------------------------- | ------------------------------------ |
| requests.exceptions.HTTPError | 401 以上の HTTP エラーが発生した場合 |

#### 処理内容
1. [`utils:get_time_stamp`](./05.utils.md#get_time_stamp) を呼び出し、タイムスタンプを取得する。
2. タイムスタンプ及び、引数 `access_token`、`client_secret` をもとに
   [`utils:compute_signature`](./05.utils.md#compute_signature) を呼び出し、署名を生成する。
3. 引数 `include` および `exclude` をもとに、取得するフィールドのパラメータを作成する。
   - `include` が None でない場合、カンマ区切りの文字列に結合する。
   - `exclude` が None でない場合、カンマ区切りの文字列に結合とする。
   - フィールド名は camelCase に変換して使用する。
4. mAP Core API に対してリクエストを送信する。
   - エンドポイント [`MAP_USERS_ENDPOINT`](../02.foundation/03.const.md#map_users_endpoint) に対して、PUT リクエストを送信する。
   - パスパラメータとして末尾に `/{user.id}` を付与する。
   - クエリパラメータとして以下を付与する。
      | 名前               | 値                                                    |
      | ------------------ | ----------------------------------------------------- |
      | attributes         | （存在する場合）引数 `include` で指定されたフィールド |
      | excludedAttributes | （存在する場合）引数 `exclude` で指定されたフィールド |
    - リクエストヘッダーに以下を付与する。
      | 名前          | 値                                                        |
      | ------------- | --------------------------------------------------------- |
      | Content-Type  | `application/json`（ **requests** により自動設定される）  |
      | Authorization | アクセストークン。 `"Bearer <access_token>"` の形式で付与 |
   - リクエストボディに、引数 `user` をシリアライズし、以下のフィールドを追加した JSON を設定する。
      | 名前                               | 値                   |
      | ---------------------------------- | -------------------- |
      | request                            | 認証情報オブジェクト |
      | &nbsp;&nbsp;&nbsp;&nbsp;time_stamp | タイムスタンプ       |
      | &nbsp;&nbsp;&nbsp;&nbsp;signature  | 署名                 |
   - サーバー設定値に従い、タイムアウト値を設定する。
5. レスポンスを解析し、HTTPステータスコードに応じた処理を行う。
   - ステータスコードが 200 の場合、レスポンスボディを
     [`MapUser`](../03.entities/03.map_user.md#mapuser) のインスタンスにデシリアライズする。
   - ステータスコードが 400 の場合、レスポンスボディを
     [`MapError`](../03.entities/04.map_error.md#maperror) のインスタンスにデシリアライズする。
   - ステータスコードが401以上の場合、`requests.Response.raise_for_status` を呼び出し 例外 `requests.exceptions.HTTPError` を送出する。
6. デシリアライズされたユーザー情報、あるいはエラー情報を戻り値として返す。


## patch_by_id
ユーザー ID に基づいて mAP Core API 上のユーザー情報を部分更新する機能を提供する。

#### 対応エンドポイント
**PATCH** /api/v2/Users/{id}

#### シグネチャ
```python[users.py]
def patch_by_id(
    user_id: str, operations: list[PatchOperation]
    /, include: set[str] | None = None, exclude: set[str] | None = None,
    *, access_token: str, client_secret: str
) -> MapUser | MapError:
```

#### 依存するライブラリ
- **requests**： HTTP リクエストの送信に使用。
- **pydantic**： リクエストおよびレスポンスのバリデーションおよびシリアライズ・デシリアライズに使用。

#### 引数
| 名前          | 型                     | 説明                                                        |
| ------------- | ---------------------- | ----------------------------------------------------------- |
| user_id       | str                    | ユーザーID                                                  |
| operations    | list\[PatchOperation\] | 更新操作のリスト                                            |
| include       | set\[str\] \| None     | 更新するフィールドのセット。None の場合はすべて更新         |
| exclude       | set\[str\] \| None     | 更新から除外するフィールドのセット。None の場合は除外しない |
| access_token  | str                    | （キーワード引数） mAP Core APIのアクセストークン           |
| client_secret | str                    | （キーワード引数） mAP Core APIのクライアントシークレット   |

#### 戻り値
| 型                                                  | 説明                                         |
| --------------------------------------------------- | -------------------------------------------- |
| [MapUser](../03.entities/03.map_user.md#mapuser)    | 更新されたユーザー情報                       |
| [MapError](../03.entities/04.map_error.md#maperror) | ユーザー情報の更新に失敗した場合のエラー情報 |

#### エラー
| 型                            | 説明                                 |
| ----------------------------- | ------------------------------------ |
| requests.exceptions.HTTPError | 401 以上の HTTP エラーが発生した場合 |

#### 処理内容
1. [`utils:get_time_stamp`](./05.utils.md#get_time_stamp) を呼び出し、タイムスタンプを取得する。
2. タイムスタンプ及び、引数 `access_token`、`client_secret` をもとに
   [`utils:compute_signature`](./05.utils.md#compute_signature) を呼び出し、署名を生成する。
3. 引数 `operations` をもとに、[`PatchRequestPayload`](../03.entities/06.patch_request.md#patchrequestpayload) のインスタンスを作成する。
4. 引数 `include` および `exclude` をもとに、取得するフィールドのパラメータを作成する。
   - `include` が None でない場合、カンマ区切りの文字列に結合する。
   - `exclude` が None でない場合、カンマ区切りの文字列に結合とする。
   - フィールド名は camelCase に変換して使用する。
5. mAP Core API に対してリクエストを送信する。
   - エンドポイント [`MAP_USERS_ENDPOINT`](../02.foundation/03.const.md#map_users_endpoint) に対して、PATCH リクエストを送信する。
   - パスパラメータとして末尾に `/{user.id}` を付与する。
   - クエリパラメータとして以下を付与する。
      | 名前               | 値                                                    |
      | ------------------ | ----------------------------------------------------- |
      | attributes         | （存在する場合）引数 `include` で指定されたフィールド |
      | excludedAttributes | （存在する場合）引数 `exclude` で指定されたフィールド |
    - リクエストヘッダーに以下を付与する。
      | 名前          | 値                                                        |
      | ------------- | --------------------------------------------------------- |
      | Content-Type  | `application/json`（ **requests** により自動設定される）  |
      | Authorization | アクセストークン。 `"Bearer <access_token>"` の形式で付与 |
   - リクエストボディに、引数 `user` をシリアライズし、以下のフィールドを追加した JSON を設定する。
      | 名前                               | 値                   |
      | ---------------------------------- | -------------------- |
      | request                            | 認証情報オブジェクト |
      | &nbsp;&nbsp;&nbsp;&nbsp;time_stamp | タイムスタンプ       |
      | &nbsp;&nbsp;&nbsp;&nbsp;signature  | 署名                 |
   - サーバー設定値に従い、タイムアウト値を設定する。
6. レスポンスを解析し、HTTPステータスコードに応じた処理を行う。
   - ステータスコードが 200 の場合、レスポンスボディを
     [`MapUser`](../03.entities/03.map_user.md#mapuser) のインスタンスにデシリアライズする。
   - ステータスコードが 400 の場合、レスポンスボディを
     [`MapError`](../03.entities/04.map_error.md#maperror) のインスタンスにデシリアライズする。
   - ステータスコードが401以上の場合、`requests.Response.raise_for_status` を呼び出し 例外 `requests.exceptions.HTTPError` を送出する。
7. デシリアライズされたユーザー情報、あるいはエラー情報を戻り値として返す。
