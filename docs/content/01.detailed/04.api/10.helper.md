---
title: api.helper
description: コントローラー層で使用するデコレータを定義する
---

## roles_required
ユーザーが権限を持っているか検証するデコレータ

#### シグネチャ
```python[helper.py]
def roles_required(*roles: str) -> Callable[[Callable[P, R]], Callable[P, R]]:
```

#### 引数
| 名前   | 型  | 説明                                   |
| ------ | --- | -------------------------------------- |
| *roles | str | アクセスを許可するロール (可変長引数 ) |

#### 戻り値
| 型            | 説明                               |
| ------------- | ---------------------------------- |
| Literal\[403] | ユーザーに要求された権限がない場合 |

#### 処理内容
1. current_user.is_member_of を引数に [`services.permissions:extract_group_ids`](../05.services/08.permissions.md#extract_group_ids) でグループ ID を取得
2. `services.utils.affiliations:detect_affiliations`を呼び出しロールを取得する
3. 引数が含まれていなければ 403 を返す

## update_login_session_ttl
ログインセッションの TTL を更新する

#### シグネチャ
```
@app.before_request
def update_login_session_ttl():
```

#### 処理内容
1. session.get(_id) でsession_id を取得
2. expire(\<prefix>\_login_<self.session_id>,REDIS_TTL) でTTL を更新
