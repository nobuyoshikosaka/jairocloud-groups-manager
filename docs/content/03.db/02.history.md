---
title: 履歴データ
description: ダウンロード履歴 /アップロード履歴を保持する。
---

## download_history テーブル
ダウンロード履歴を保持するテーブル。

#### カラム定義

| カラム名  | データ型                     | NOT NULL | デフォルト値           | 説明                      |
| --------- | ---------------------------- | -------- | ---------------------- | ------------------------- |
| id        | uuid                         | Yes      |                        | 履歴データの ID           |
| timestamp | timestamp (6) with time zone | Yes      | timezone('UTC', now()) | ダウンロード日時          |
| file_id   | uuid                         | Yes      |                        | ファイル ID               |
| operator  | character varying(50)        | Yes      | true                   | 操作の実行ユーザー        |
| public    | boolean                      | Yes      |                        | 履歴の公開 / 非公開フラグ |
| parent_id | uuid                         |          |                        | 初回ダウンロードの ID     |

#### インデックス

| インデックス名                | 対象カラム | 主キー | ユニーク |
| ----------------------------- | ---------- | ------ | -------- |
| pk_download_history           | id         | Yes    | Yes      |
| ix_download_history_operator  | operator   |        |          |
| ix_download_history_timestamp | timestamp  |        |          |

#### 制約

| 制約名              | 対象カラム | 制約種別 |
| ------------------- | ---------- | -------- |
| pk_download_history | id         | 主キー   |

#### 外部キー

| 外部キー名                                     | 対象カラム | 参照先テーブル   | 参照先カラム |
| ---------------------------------------------- | ---------- | ---------------- | ------------ |
| fk_download_history_file_id_files              | file_id    | files            | id           |
| fk_download_history_parent_id_download_history | parent_id  | download_history | id           |


#### 外部キー（ PK 側）

| 外部キー名                                     | 対象カラム | 参照元テーブル   | 参照元カラム |
| ---------------------------------------------- | ---------- | ---------------- | ------------ |
| fk_download_history_parent_id_download_history | id         | download_history | parent_id    |

#### 備考
( なし )


## upload_history テーブル
アップロード履歴を保持するテーブル。

#### カラム定義

| カラム名      | データ型                     | NOT NULL | デフォルト値           | 説明                             |
| ------------- | ---------------------------- | -------- | ---------------------- | -------------------------------- |
| id            | uuid                         | Yes      |                        | 履歴データの ID                  |
| timestamp     | timestamp (6) with time zone | Yes      | timezone('UTC', now()) | アップロード開始日時             |
| end_timestamp | timestamp (6) with time zone |          |                        | アップロード終了日時             |
| file_id       | uuid                         | Yes      |                        | ファイル ID                      |
| operator      | character varying(50)        | Yes      |                        | 操作の実行ユーザー               |
| public        | boolean                      | Yes      | true                   | 履歴の公開 / 非公開フラグ        |
| status        | character varying(1)         | Yes      |                        | アップロード状況                 |
| results       | jsonb                        |          |                        | アップロード結果                 |

#### インデックス

| インデックス名              | 対象カラム | 主キー | ユニーク |
| --------------------------- | ---------- | ------ | -------- |
| pk_upload_history           | id         | Yes    | Yes      |
| ix_upload_history_operator  | operator   |        |          |
| ix_upload_history_results   | results    |        |          |
| ix_upload_history_timestamp | timestamp  |        |          |

#### 制約

| 制約名                   | 対象カラム | 制約種別 |
| ------------------------ | ---------- | -------- |
| pk_upload_history        | id         | 主キー   |
| ck_upload_history_status | status     | CHECK    |

#### 外部キー

| 外部キー名                      | 対象カラム | 参照先テーブル | 参照先カラム |
| ------------------------------- | ---------- | -------------- | ------------ |
| fk_upload_history_file_id_files | file_id    | files          | id           |

#### 外部キー（ PK 側）
( なし )

#### 備考
( なし )


## files テーブル
アップロード / ダウンロードに用いたファイルの情報を保持するテーブル。

#### カラム定義

| カラム名     | データ型                | NOT NULL | デフォルト値 | 説明                         |
| ------------ | ----------------------- | -------- | ------------ | ---------------------------- |
| id           | uuid                    | Yes      |              | ファイル ID                  |
| file_path    | character varying(1024) | Yes      |              | ファイルパス                 |
| file_content | jsinb                   | Yes      |              | ファイル内のユーザー等の情報 |

#### インデックス

| インデックス名        | 対象カラム   | 主キー | ユニーク |
| --------------------- | ------------ | ------ | -------- |
| pk_files              | id           | Yes    | Yes      |
| ix_files_file_content | file_content |        |          |

#### 制約

| 制約名   | 対象カラム | 制約種別 |
| -------- | ---------- | -------- |
| pk_files | id         | 主キー   |

#### 外部キー
( なし )

#### 外部キー（ PK 側）
| 外部キー名                        | 対象カラム | 参照元テーブル   | 参照元カラム |
| --------------------------------- | ---------- | ---------------- | ------------ |
| fk_download_history_file_id_files | id         | download_history | file_id      |
| fk_upload_history_file_id_files   | id         | upload_history   | file_id      |

#### 備考
( なし )
